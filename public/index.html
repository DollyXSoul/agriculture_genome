<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Agricultural Genomics Align</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üåæ Skip‚ÄëAware Alignment</h1>
        <p>Linear‚Äëspace DP with free skips over reference gaps</p>
      </header>

      <div class="tabs" role="tablist">
        <button class="btn btn-outline tab-button active" data-target="text">
          Text Input
        </button>
        <button
          class="btn btn-outline tab-button"
          role="tab"
          data-target="file"
        >
          File Upload
        </button>
      </div>


      

      <section id="text" class="tab-content active" role="tabpanel">
        <form id="text-align-form">
          <div class="form-group">
            <label>Reference (use '-' for known gaps)</label>
            <textarea
              id="reference"
              name="reference"
              placeholder="ACGT-ACGT"
              required
            ></textarea>
          </div>
          <div class="form-group">
            <label>Query</label>
            <textarea
              id="query"
              name="query"
              placeholder="ACGTACGT"
              required
            ></textarea>
          </div>
          <div class="form-group">
            <label>Band width (optional)</label>
            <input
              id="textBand"
              name="band"
              type="number"
              placeholder="e.g., 5000"
            />
          </div>
          <div class="form-group">
            <label
              ><input type="checkbox" id="textCounts" name="wantCounts" />
              detailed counts (short inputs only)</label
            >
          </div>
           <div class="form-group">
<label class="option">
  <input type="checkbox" id="wantDpViewText" >
  Show DP tables (small inputs only)
</label>
          </div>
          <div class="form-group">
            <label
              ><input
                type="checkbox"
                id="textTranscript"
                name="wantTranscript"
              />
              show per-position operations</label
            >
          </div>
          <button type="submit">üß¨ Align</button>
        </form>
      </section>

      <section id="file" class="tab-content" role="tabpanel">
        <form id="file-align-form" enctype="multipart/form-data">
          <div class="form-group">
            <label>Reference FASTA/.fna</label>
            <input
              type="file"
              id="reference-file"
              name="referenceFile"
              accept=".fa,.fasta,.fna,.txt"
              required
            />
          </div>
          <div class="form-group">
            <label>Query FASTA/.fna</label>
            <input
              type="file"
              id="query-file"
              name="queryFile"
              accept=".fa,.fasta,.fna,.txt"
              required
            />
          </div>
          <div class="form-group">
            <label>Max bases per file (default 300,000)</label>
            <input
              id="maxLen"
              name="maxLen"
              type="number"
              value="300000"
              min="1000"
              step="1000"
            />
          </div>
          <div class="form-group">
            <label>Band width (optional)</label>
            <input
              id="band"
              name="band"
              type="number"
              placeholder="e.g., 5000"
            />
          </div>
          <div class="form-group">
            <label
              ><input type="checkbox" id="wantCounts" name="wantCounts" />
              detailed counts (short inputs only)</label
            >
          </div>


          <div class="form-group">
            <label
              ><input
                type="checkbox"
                id="wantTranscript"
                name="wantTranscript"
              />
              show per-position operations (small inputs only)</label
            >
          </div>

          <div class="form-group">
<label class="option">
  <input type="checkbox" id="wantDpViewFile" >
  Show DP tables (small inputs only)
</label>
          </div>

          <button type="submit">üìÅ Upload & Align</button>
        </form>
      </section>

      <div id="loading" style="display: none">üîÑ Running alignment‚Ä¶</div>
      <div id="results" style="display: none">
        <h2>Results</h2>
        <div id="results-content"></div>


        <div id="perpos" class="result-item" style="display: none">
          <div class="result-label">Per-position alignment</div>
          <div id="perpos-content"></div>
          <div id="dp-section" class="result-item" hidden>
  <div class="result-label">DP tables (snapshot)</div>
  <div class="dp-tabs">
    <button type="button" class="btn btn-ghost dp-tab active" data-state="M">M (match/mismatch)</button>
    <button type="button" class="btn btn-ghost dp-tab" data-state="I">I (insertion)</button>
    <button type="button" class="btn btn-ghost dp-tab" data-state="D">D (deletion)</button>
    <button type="button" class="btn btn-ghost dp-tab" data-state="S">S (skip)</button>
  </div>
  <div id="dp-table-container"></div>
  <div class="dp-note">
    Showing up to 20√ó20 prefix of each DP matrix for this alignment.
  </div>
</div>
          <div style="margin-top: 6px; font-size: 0.9em; color: #666">
            M=match, X=mismatch, I=insert (extra reference base), D=delete
            (extra query base), S=skip (free over ‚Äò-‚Äô in reference)
          </div>
        </div>
      </div>
    </div>
    <div class="result-item" id="scoring-info">
      <h3>Scoring &amp; Interpretation</h3>



  <p>The aligner uses four DP states: M (match/mismatch), I (insertion), D (deletion), and S (skip over an existing gap), and the final score is min{ M<sub>m,n</sub>, I<sub>m,n</sub>, D<sub>m,n</sub>, S<sub>m,n</sub> }.</p>

  <ul>
    <li>Match (M): cost 0</li>
    <li>Mismatch (X): cost 1</li>
    <li>Insertion (I): cost 1 per base (unit gaps)</li>
    <li>Deletion (D): cost 1 per base (unit gaps)</li>
    <li>Skip (S): cost 0 (free across ‚Äò-‚Äô in the reference)</li>
  </ul>

  <p>Interpretation: with unit costs, the score equals the number of penalized edits (X/I/D) needed to transform the query into the reference while treating pre‚Äëexisting reference gaps as free skips.</p>

 <ul>
  <li>Score 0: identical modulo free skips; transcript contains only M and S, so no mismatches or new gaps were needed. </li>
  <li>Score 1‚Äì10 (unit costs): extremely close sequences; roughly up to 10 penalized edits total (X/I/D) across the region. </li>
  <li>Score 20 (over L<sub>eff</sub>=5,000): ~0.4% divergence; PID ‚âà 1 ‚àí 20/5000 = 99.6%. </li>
  <li>Score 50 (over L<sub>eff</sub>=5,000): ~1% divergence; PID ‚âà 1 ‚àí 50/5000 = 99%.</li>
  <li>Score 100 (over L<sub>eff</sub>=5,000): ~2% divergence; PID ‚âà 1 ‚àí 100/5000 = 98%.</li>
  
</ul>


  
</div>


    </div>
    <script src="script.js"></script>
  </body>
</html>
